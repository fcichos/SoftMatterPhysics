{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Equipartition"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In the previous section, we showed how the probability distribution for a system with average energy $\\langle E \\rangle$ could be guessed by using the principle of maximum entropy. However, to finish that calculation, we need to determine the meaning and significance of the Lagrange multiplier $\\beta$. We can derive a value for $\\beta$ with the help of the equipartition theorem.\n",
    "\n",
    "<div class=\"alert alert-warning\">\n",
    "The equipartition theorem, also known as the law of equipartition, equipartition of energy or simply equipartition, states that every degree of freedom that appears only quadratically in the total energy has an average energy of $\\frac{1}{2}k_B T$.\n",
    "</div>\n",
    "  \n",
    "\n",
    "To obtain the Lagrange parameter we just consider one degree of freedom for a monoatomic gas. This degree of freedom is the kinetic energy of one atom along the x-direction, which is given by\n",
    "\n",
    "\\begin{equation}\n",
    "E=\\frac{p_{X}^{2}}{2 m}\n",
    "\\end{equation}\n",
    "\n",
    "\n",
    "According to the Boltzmann distribution, the probability to find an atom with a certain momentum is given by\n",
    "\n",
    "\\begin{equation}\n",
    "P\\left(p_{x}\\right)=\\frac{\\mathrm{e}^{-\\beta\\left(p_{x}^{2} / 2 m\\right)}}{\\sum_{\\text {states }} \\mathrm{e}^{-\\beta\\left(p_{x}^{2} / 2 m\\right)}}\n",
    "\\end{equation}\n",
    "\n",
    "We can thus calculate the mean energy by summing up (or integrating when going to continuous states) over alls possible momenta\n",
    "\n",
    "\\begin{equation}\n",
    "\\sum_{\\text {states }} \\rightarrow \\int_{-\\infty}^{\\infty} \\mathrm{d} p_{x}\n",
    "\\end{equation}\n",
    "\n",
    "\n",
    "This yields\n",
    "\n",
    "\\begin{equation}\n",
    "\\int_{-\\infty}^{\\infty} \\mathrm{e}^{-\\beta p_{x}^{2} / 2 m} \\mathrm{~d} p_{x}=\\sqrt{\\frac{2 m \\pi}{\\beta}}\n",
    "\\end{equation}\n",
    "\n",
    "To obtain the value of $\\beta$ we now constrain the mean energy to the value given by the equiparition principle\n",
    "\n",
    "\\begin{equation}\n",
    "\\langle E\\rangle=\\frac{1}{2} k_{\\mathrm{B}} T\n",
    "\\end{equation}\n",
    "\n",
    "This is the mean energy per degree of freedom. One can show that each degree of freedom, independent of the object (atom, colloid, parking car) is carrying this mean energy. It provides actually our measure of temperature.\n",
    "\n",
    "Using the momentum to calculate the mean energy we write down \n",
    "\n",
    "\\begin{equation}\n",
    "\\langle E\\rangle=\\frac{\\int_{-\\infty}^{\\infty} \\frac{p_{x}^{2}}{2 m} \\mathrm{e}^{-\\beta\\left(p_{x}^{2} / 2 m\\right)} \\mathrm{d} p_{x}}{\\sqrt{2 m \\pi / \\beta}}\n",
    "\\end{equation}\n",
    "\n",
    "which can be slightly simplified \n",
    "\n",
    "\\begin{equation}\n",
    "\\langle E\\rangle=\\frac{\\alpha^{3 / 2}}{\\beta \\sqrt{\\pi}}\\left(-\\frac{\\partial}{\\partial \\alpha}\\right) \\int_{-\\infty}^{\\infty} \\mathrm{e}^{-\\alpha p_{x}^{2}} \\mathrm{~d} p_{x}\n",
    "\\end{equation}\n",
    "\n",
    "and calculated via some tricks valid for integrals over Gaussian functions. This finally leads us to the result that the value of the Lagrangian multiplier must be\n",
    "\n",
    "\\begin{equation}\n",
    "\\beta=\\frac{1}{k_{\\mathrm{B}} T}\n",
    "\\end{equation}\n",
    "\n",
    "\n",
    "<div class=\"alert alert-warning\">\n",
    "A good example for a non-quadratic degree of freedom is the barometric height formula with a potential energy that is linear in position.\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Equipartition is useful in many ways. The fundamental degrees of freedom, e.g. the vibrations of a single molecule are quadratic in the bond length. Similarly all rotational degrees of freedom are as well. Their occupation is determined by a Boltzmann distribution and readily visible in molecular spectra. On more macroscopic scales it is very useful in the field of force measurements using optical tweezers."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-info\">\n",
    "    \n",
    "    \n",
    "**Example: Two-level-system**\n",
    "\n",
    "As another frequent application of Boltzmann’s law are state populations of two state systems, as we find them frequently in physics, e.g., for spin systems. Such two level spin systems are, for example, very important for nuclear magnetic resonance (NMR), which is an important tool to study the structure and dynamics of soft matter.\n",
    "\n",
    "![Two Level](img/two_level.png)\n",
    "    \n",
    "Consider the image above, where a single energy level at zero magnetic field ($B=0$) splits into two energy levels due to the interaction of a proton spin (red arrow) with the external magnetic field.\n",
    "    \n",
    "The magnetic moment of the proton spin may take two expectation values in the magnetic field, which are characterized by the magnetic quantum number $m_Z=\\pm 1/2$. The magnetic moment projected along the magnetic field direction is then \n",
    "    \n",
    "$$\\mu_Z=\\gamma m_Z \\hbar$$\n",
    "\n",
    "and the energy of the states\n",
    "    \n",
    "$$E(m_Z)=-\\mu_Z B=-\\gamma m_Z \\hbar B$$\n",
    "\n",
    "with $\\gamma=2.675222005\\times 10^{8}\\; \\mathrm{s}^{-1} \\mathrm{T}^{-1}$ being the gyromagnetic ratio of the proton.\n",
    "The energy difference for a nonzero magnetic field is therefore given by\n",
    "    \n",
    "$$\\Delta E=\\gamma \\hbar B=\\hbar \\omega_\\mathrm{L}$$\n",
    "    \n",
    "which results for a magnetic field of $B=1\\; \\mathrm{T}$ in $\\Delta E\\approx 1.76\\times 10^{-7}\\;{\\rm eV}$ or a Larmor frequency of $\\omega_\\mathrm{L}=42\\; {\\rm MHz}$. This energy difference is almost negligible as compared to the thermal energy at room temperature $k_\\mathrm{B}T=2.6\\times 10^{-2}\\;{\\rm eV}$. Yet, this small energy difference is used to give the contrast in NMR and related techniques such as MRI.\n",
    "    \n",
    "Using the Boltzmann distribution we can now calculate the ratio of the population of spins in the lower or excited state\n",
    "    \n",
    "$$\\frac{N_{-\\frac{1}{2}}}{N_{+\\frac{1}{2}}}=\\exp\\left (-\\frac{\\Delta E}{k_\\mathrm{B} T} \\right )$$\n",
    "    \n",
    "which is very close to one: $$\\frac{N_{-\\frac{1}{2}}}{N_{+\\frac{1}{2}}}=0.99999332.$$\n",
    "    \n",
    "If you consider now a volume of $V=1\\;{\\rm {\\mu m}}^3$ water, then you would roughly have about $N=6.7\\times 10^{19}$ protons. This then means that the excess number of protons in the excited state is just $N_{+\\frac{1}{2}}-N_{-\\frac{1}{2}}=4.5\\times 10^{12}$, which is extremely low. Thus, to detect something in NMR or MRI, a certain number of protons in the volume is required.    \n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-info\">\n",
    "    \n",
    "**Example: Position of a Bead in an Optical Tweezer**\n",
    "    \n",
    "In an optical tweezer, a polarizable object (e.g. a polymer bead) is hold in the intensity gradient of a focused laser beam. The nearly Gaussian intensity distribution of a focused beam leads, in first approximation to a linear force a parabolic potential and can be employed to measure tiny forces.   \n",
    "    \n",
    "    \n",
    "![tweezers](img/tweezers.png)\n",
    "\n",
    "    \n",
    "For one dimension of the 3D optical potential it can thus be written as\n",
    "    \n",
    "\\begin{equation}\n",
    "F=-k x\n",
    "\\end{equation}\n",
    "    \n",
    "    and \n",
    "\n",
    "\\begin{equation}\n",
    "E=\\frac{1}{2}k x^2\n",
    "\\end{equation}\n",
    "    \n",
    "Using the Boltznmann distribution for the potential provides the probability distribution for finding the particle at a certain position $x$\n",
    "    \n",
    "    \n",
    "\\begin{equation}    \n",
    "p(x)=\\frac{1}{Z}\\exp\\left(-\\frac{kx^2}{2k_B T} \\right)\n",
    "\\end{equation}    \n",
    "\n",
    "which resembles a Gaussian distribution with a variance of\n",
    "\n",
    "\\begin{equation}\n",
    "\\sigma^2=\\langle x^2 \\rangle =\\frac{k_B T}{k}\n",
    "\\end{equation}   \n",
    "    \n",
    "    \n",
    "We also readily recognize that the partition function $Z$ is the normalization factor of the Gaussian\n",
    "    \n",
    "\\begin{equation}\n",
    "Z=\\sqrt{2\\pi }\\sigma=\\sqrt{2\\pi\\frac{k_B T }{k}}\n",
    "\\end{equation}\n",
    "    \n",
    "The mean potential energy is then calculated by\n",
    "    \n",
    "\\begin{equation}\n",
    "\\langle E \\rangle =\\int_{-\\infty}^{\\infty} E\\, p(x)\\,dx=\\frac{1}{2}k\\int_{-\\infty}^{\\infty} x^2 p(x)dx=\\frac{1}{2}k \\frac{k_B T}{k}=\\frac{1}{2}k_B T\n",
    "\\end{equation}\n",
    "    \n",
    "With the help of the variance of the distribution mentioned above, we also recognize that the trap stiffness can be obtained by dividing th ethermal energy $k_B T$ by the variance of the positional fluctuations. \n",
    "    \n",
    "\\begin{equation}\n",
    "k=\\frac{k_B T}{\\langle x^2\\rangle }\n",
    "\\end{equation}\n",
    "\n",
    "which is very helpful for the experiment calibrating the trap stiffness for using the tweezers for force measurements. According to that you just have to observe the position of the trapped object in the potential and measure the variance.   \n",
    "We will deal with this relation later again in the section about the fluctuation dissipation relation.    \n",
    "\n",
    "The second degree of freedom of a particle in an optical tweezer is given by its velocity $v$. This is as well a quadratic degree in $v$, yet its measurement turns out to be tricky. As the particle is carrying out Brownian motion in the trap, its velocity is not given by the difference of positions divided by the difference in observation times. To measure the velocity accurately one has to got to very short times, when the particle is carrying out ballistic motion. This has been achieved only about 10 years ago, while the distribution connected to the velocities, the **Maxwell-Boltzmann distribution** is already known for a very long time.\n",
    "    \n",
    "Take some time to have a look at the Maxwell-Boltzmann distribution again.\n",
    "    \n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "tags": [],
    "toc-hr-collapsed": true
   },
   "source": [
    "## When a Macrostate is a Microstate"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In practice, we are often interested in the likelihood that the system is in a state that is described by some macroscopic parameter $X$ that we can measure. For example, for a DNA molecule inside a cell, an interesting quantity, which can be measured using fluorescent markers, is the distance R between two sites on the DNA chain. Repeated measurements of $R$ can to construct the probability distribution p(R).\n",
    "\n",
    "In general, the probability of the macrostate $X$ is given by the sum of probabilities of all the microstates of the system that adopt the specified value $X$,\n",
    "\n",
    "\\begin{equation} \n",
    "p(X)=\\sum_{i_{X}} p_{i}=\\sum_{i_{X}} \\frac{1}{Z} \\mathrm{e}^{-\\beta E_{i}}\n",
    "\\end{equation}\n",
    "\n",
    "For the DNA example, the sum in the above equation would run over only those microstates $i_X$ that have the prescribed distance between the two labeled sites on the polymer, e.g. $X=R$.\n",
    "Using the basic relation between the partition function and the free energy, $G = −k_BT \\ln(Z)$, we can express the probability of the macrostate X as\n",
    "\n",
    "\\begin{equation}\n",
    "p(X)=\\frac{1}{Z} \\mathrm{e}^{-\\beta G(X)}\n",
    "\\end{equation}\n",
    "\n",
    "where\n",
    "\n",
    "\\begin{equation}\n",
    "G(X)=-k_{\\mathrm{B}} T \\ln \\left(\\sum_{i_{X}} \\mathrm{e}^{-\\beta E_{i}}\\right)\n",
    "\\end{equation}\n",
    "\n",
    "is the free energy of the macrostate $X$. Note that the formula for $p(X)$ is identical to the Boltzmann formula for the probability of a microstate, with the energy of the microstate replaced by the free energy of the macrostate. Note that the sum on the right side of the last equation is not the partition function $Z$ but that of the subensemble of microstates fulfilling the condition X, i.e. $Z_X$. Similarly, when writing down the states and weights for the macrostates $X$, the energy is replaced by the free energy, as shown in in the figure below. In this sense, one person’s macrostate is truly another person’s microstate.\n",
    "\n",
    "\n",
    "![micro_macro](img/micro_macro.png)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.5"
  },
  "toc": {
   "base_numbering": "1",
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {
    "height": "calc(100% - 180px)",
    "left": "10px",
    "top": "150px",
    "width": "384px"
   },
   "toc_section_display": true,
   "toc_window_display": true
  },
  "toc-autonumbering": false,
  "toc-showcode": false,
  "toc-showmarkdowntxt": false,
  "toc-showtags": false,
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {},
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
